<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Gamedev Canvas Workshop - lesson 10: finishing up</title>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      canvas {
        background: #eee;
        display: block;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <canvas id="myCanvas" width="480" height="320"></canvas>

    <script>
      const canvas = document.getElementById("myCanvas");
      const ctx = canvas.getContext("2d");
      let rightPressed = false;
      let leftPressed = false;

      class Game {
        constructor(life, brickRowCount, brickColumnCount) {
          this.score = 0;
          this.life = life;
          this.brickRowCount = brickRowCount;
          this.brickColumnCount = brickColumnCount;
          this.bricks = [];
          this.ball = new Ball(2, -2, 10);
          this.paddle = new Paddle();
          this.initBricks();
        }

        initBricks() {
          for (let c = 0; c < this.brickColumnCount; c++) {
            this.bricks[c] = [];
            for (let r = 0; r < this.brickRowCount; r++) {
              this.bricks[c][r] = { x: 0, y: 0, status: 1 };
            }
          }
        }

        collisionDetection() {
          for (let c = 0; c < this.brickColumnCount; c++) {
            for (let r = 0; r < this.brickRowCount; r++) {
              let b = this.bricks[c][r];
              if (b.status == 1) {
                if (
                  x > b.x &&
                  x < b.x + brickWidth &&
                  y > b.y &&
                  y < b.y + brickHeight
                ) {
                  dy = -dy;
                  b.status = 0;
                  this.score++;
                  if (
                    this.score ==
                    this.brickRowCount * this.brickColumnCount
                  ) {
                    alert("YOU WIN, CONGRATS!");
                    document.location.reload();
                  }
                }
              }
            }
          }
        }

        drawScore() {
          ctx.font = "16px Arial";
          ctx.fillStyle = "#0095DD";
          ctx.fillText("Score: " + this.score, 8, 20);
        }

        drawLife() {
          ctx.font = "16px Arial";
          ctx.fillStyle = "#0095DD";
          ctx.fillText("life: " + this.life, canvas.width - 65, 20);
        }

        drawBricks() {
          for (let c = 0; c < this.brickColumnCount; c++) {
            for (let r = 0; r < this.brickRowCount; r++) {
              if (bricks[c][r].status == 1) {
                let brickX =
                  r * (Brick.brickWidth + Brick.brickPadding) +
                  Brick.brickOffsetLeft;
                let brickY =
                  c * (Brick.brickHeight + Brick.brickPadding) +
                  Brick.brickOffsetTop;
                bricks[c][r].x = brickX;
                bricks[c][r].y = brickY;
                ctx.beginPath();
                ctx.rect(brickX, brickY, Brick.brickWidth, Brick.brickHeight);
                ctx.fillStyle = "#0095DD";
                ctx.fill();
                ctx.closePath();
              }
            }
          }
        }

        drawAll() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          this.drawBricks();
          this.ball.drawBall();
          this.paddle.drawPaddle();
          this.drawScore();
          this.drawLife();
          this.collisionDetection();

          if (
            this.ball.x + this.ball.dx > canvas.width - this.ball.ballRadius ||
            this.ball.x + this.ball.dx < this.ball.ballRadius
          ) {
            this.ball.dx = -this.ball.dx;
          }
          if (this.ball.y + this.ball.dy < this.ball.ballRadius) {
            this.ball.dy = -this.ball.dy;
          } else if (
            this.ball.y + this.ball.dy >
            canvas.height - this.ball.ballRadius
          ) {
            if (
              this.ball.x > this.paddal.paddleX &&
              this.ball.x < this.paddal.paddleX + this.paddle.paddleWidth
            ) {
              this.ball.dy = -this.ball.dy;
            } else {
              life--;
              if (!life) {
                alert("GAME OVER");
                document.location.reload();
              } else {
                this.ball.x = canvas.width / 2;
                this.ball.y = canvas.height - 30;
                this.ball.dx = 3;
                this.ball.dy = -3;
                this.paddal.paddleX =
                  (canvas.width - this.paddle.paddleWidth) / 2;
              }
            }
          }

          if (
            rightPressed &&
            this.paddal.paddleX < canvas.width - this.paddle.paddleWidth
          ) {
            this.paddal.paddleX += 7;
          } else if (leftPressed && this.paddal.paddleX > 0) {
            this.paddal.paddleX -= 7;
          }

          this.ball.x += this.ball.dx;
          this.ball.y += this.ball.dy;

          requestAnimationFrame.call(this, this.drawAll);
        }


      }

      class Ball {
        constructor(dx, dy, ballRadius) {
          this.x = canvas.width / 2;
          this.y = canvas.height - 30;
          this.dx = dx;
          this.dy = dy;
          this.ballRadius = ballRadius;
        }

        reset() {
          this.x = canvas.width / 2;
          this.y = canvas.height - 30;
          this.dx = 2;
          this.dy = -2;
        }

        drawBall() {
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.ballRadius, 0, Math.PI * 2);
          ctx.fillStyle = "#0095DD";
          ctx.fill();
          ctx.closePath();
        }
      }

      class Brick {
        constructor() {
          this.brickWidth = 75;
          this.brickHeight = 20;
          this.brickPadding = 10;
          this.brickOffsetTop = 30;
          this.brickOffsetLeft = 30;
        }

        drawBrick(brickX, brickY) {
          ctx.beginPath();
          ctx.rect(brickX, brickY, this.brickWidth, this.brickHeight);
          ctx.fillStyle = "#0095DD";
          ctx.fill();
          ctx.closePath();
        }
      }

      class Paddle {
        constructor() {
          this.paddleHeight = 10;
          this.paddleWidth = 75;
          this.paddleX = (canvas.width - this.paddleWidth) / 2;
        }

        drawPaddle() {
          ctx.beginPath();
          ctx.rect(
            this.paddleX,
            canvas.height - this.paddleHeight,
            this.paddleWidth,
            this.paddleHeight
          );
          ctx.fillStyle = "#0095DD";
          ctx.fill();
          ctx.closePath();
        }
      }

      let game = new Game();
      game.drawAll();

      //       const ballRadius = 10;
      //       const paddleHeight = 10;
      //       const paddleWidth = 75;
      //       const paddleX = (canvas.width - paddleWidth) / 2;
      //       const rightPressed = false;
      //       const leftPressed = false;
      //       const brickRowCount = 5;
      //       const brickColumnCount = 3;
      //       const brickWidth = 75;
      //       const brickHeight = 20;
      //       const brickPadding = 10;
      //       const brickOffsetTop = 30;
      //       const brickOffsetLeft = 30;

      //       let bricks = [];
      //       for (let c = 0; c < brickColumnCount; c++) {
      //         bricks[c] = [];
      //         for (let r = 0; r < brickRowCount; r++) {
      //           bricks[c][r] = { x: 0, y: 0, status: 1 };
      //         }
      //       }

      //       document.addEventListener("keydown", keyDownHandler, false);
      //       document.addEventListener("keyup", keyUpHandler, false);
      //       document.addEventListener("mousemove", mouseMoveHandler, false);

      //       function keyDownHandler(e) {
      //         if (e.keyCode == 39) {
      //           rightPressed = true;
      //         } else if (e.keyCode == 37) {
      //           leftPressed = true;
      //         }
      //       }
      //       function keyUpHandler(e) {
      //         if (e.keyCode == 39) {
      //           rightPressed = false;
      //         } else if (e.keyCode == 37) {
      //           leftPressed = false;
      //         }
      //       }
      //       function mouseMoveHandler(e) {
      //         let relativeX = e.clientX - canvas.offsetLeft;
      //         if (relativeX > 0 && relativeX < canvas.width) {
      //           paddleX = relativeX - paddleWidth / 2;
      //         }
      //       }

      //       function drawBall() {
      //         ctx.beginPath();
      //         ctx.arc(x, y, ballRadius, 0, Math.PI * 2);
      //         ctx.fillStyle = "#0095DD";
      //         ctx.fill();
      //         ctx.closePath();
      //       }
      //       function drawPaddle() {
      //         ctx.beginPath();
      //         ctx.rect(
      //           paddleX,
      //           canvas.height - paddleHeight,
      //           paddleWidth,
      //           paddleHeight
      //         );
      //         ctx.fillStyle = "#0095DD";
      //         ctx.fill();
      //         ctx.closePath();
      //       }

      //       function drawBricks() {
      //         for (let c = 0; c < brickColumnCount; c++) {
      //           for (let r = 0; r < brickRowCount; r++) {
      //             if (bricks[c][r].status == 1) {
      //               let brickX = r * (brickWidth + brickPadding) + brickOffsetLeft;
      //               let brickY = c * (brickHeight + brickPadding) + brickOffsetTop;
      //               bricks[c][r].x = brickX;
      //               bricks[c][r].y = brickY;
      //               ctx.beginPath();
      //               ctx.rect(brickX, brickY, brickWidth, brickHeight);
      //               ctx.fillStyle = "#0095DD";
      //               ctx.fill();
      //               ctx.closePath();
      //             }
      //           }
      //         }
      //       }
      //       function drawScore() {
      //         ctx.font = "16px Arial";
      //         ctx.fillStyle = "#0095DD";
      //         ctx.fillText("Score: " + score, 8, 20);
      //       }
      //       function drawLives() {
      //         ctx.font = "16px Arial";
      //         ctx.fillStyle = "#0095DD";
      //         ctx.fillText("Lives: " + lives, canvas.width - 65, 20);
      //       }

      //       draw();
    </script>
  </body>
</html>
